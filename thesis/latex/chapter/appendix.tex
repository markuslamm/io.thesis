\appendix

\chapter{}
\addcontentsline{toc}{chapter}{Appendix A}

\section{Collectors JSON results}
\subsection{JvmCollector}
\subsection{DstatCollector}
\subsection{FlinkRestCollector}
\subsection{FlinkJmxCollector}
\subsection{KafkaBrokerJmxCollector}

\section{Apache Flink 1.1.0 API JSON responses}
\verb|GET /jobs|
%\begin{lstlisting}[caption={DStatCollector JSON payload}, captionpos=b, label={lst:dstat-payload}]
%{
%  "jobs-running": [],
%  "jobs-finished": [
%    "df399b48d225cda1a5c0a36ed9519b62",
%    "2efc5e7c9a9f274efbb420a01e6b00cc"
%  ],
%  "jobs-cancelled": [],
%  "jobs-failed": []
%}
%\end{lstlisting}

\section{Apache Kafka 0.9.0.1 MBeans}
\begin{table}[H]
    \begin{tabular}{l}
        \textbf{JMX ObjectName} \\
        kafka.controller:type=ControllerStats,name=LeaderElectionRateAndTimeMs \\
        kafka.controller:type=ControllerStats,name=UncleanLeaderElectionsPerSec \\
        kafka.controller:type=KafkaController,name=ActiveControllerCount \\
        kafka.controller:type=KafkaController,name=OfflinePartitionsCount \\
        kafka.controller:type=KafkaController,name=PreferredReplicaImbalanceCount \\
        kafka.network:type=Processor,name=IdlePercent,networkProcessor=* \\
        kafka.server:type=socket-server-metrics,networkProcessor=* \\
        kafka.server:type=controller-channel-metrics,broker-id=* \\
        kafka.server:type=ReplicaManager,name=IsrExpandsPerSec \\
        kafka.server:type=ReplicaManager,name=IsrShrinksPerSec \\
        kafka.server:type=ReplicaManager,name=LeaderCount \\
        kafka.server:type=ReplicaManager,name=PartitionCount \\
        kafka.server:type=ReplicaManager,name=UnderReplicatedPartitions \\
        kafka.server:type=KafkaRequestHandlerPool,name=RequestHandlerAvgIdlePercent \\
        kafka.server:type=BrokerTopicMetrics,name=TotalProduceRequestsPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=TotalProduceRequestsPerSec,topic=* \\
        kafka.server:type=BrokerTopicMetrics,name=TotalFetchRequestsPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=TotalFetchRequestsPerSec,topic=* \\
        kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec,topic=* \\
        kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec,topic=* \\
        kafka.server:type=BrokerTopicMetrics,name=BytesRejectedPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=BytesRejectedPerSec,topic=* \\
        kafka.server:type=BrokerTopicMetrics,name=FailedFetchRequestsPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=FailedFetchRequestsPerSec,topic=* \\
        kafka.server:type=BrokerTopicMetrics,name=FailedProduceRequestsPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=FailedProduceRequestsPerSec,topic=* \\
        kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec \\
        kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec,topic=* \\
        kafka.coordinator:type=GroupMetadataManager,name=NumGroups \\
        kafka.coordinator:type=GroupMetadataManager,name=NumOffsets \\
    \end{tabular}
    \caption{Collected Kafka MBeans}
    \label{tbl:kafka-controller}
\end{table}

\section{Docker Configuration}
\label{app:docker-config}

\begin{lstlisting}[caption={"Collector-Platform" cluster configuration}, captionpos=b, label={lst:docker-config-all}]
version: '2'
services:

  consul:
    image: "progrium/consul:latest"
    container_name: "consul"
    hostname: "consul"
    ports:
      - "8400:8400"
      - "8500:8500"
      - "8600:53"
    command: "-server -bootstrap-expect 1 -ui-dir /ui"

  zookeeper:
    container_name: zookeeper
    image: wurstmeister/zookeeper
    ports:
      - "2181:2181"

  kafka:
    container_name: kafka
    image: wurstmeister/kafka
    ports:
      - "9092:9092"
      - "9997:9999"   # jmx
      - "9097:9091"   # collector-client
    environment:
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_HOST_NAME: 192.168.2.100
      KAFKA_CREATE_TOPICS: "collector-outbound-topic:1:1,flink-outbound-topic:1:1"
      JMX_PORT: 9999
      SPRING_PROFILES_ACTIVE: kafka-broker-jmx
      SPRING_CLOUD_CONSUL_HOST: consul
      SPRING_CLOUD_CONSUL_PORT: 8500
      CLIENT_PORT: 9091
      KAFKA_BROKER_ADDRESS: kafka:9092
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - zookeeper
      - consul

  flink-jobmanager:
    image: flink
    container_name: flink-jobmanager
    ports:
      - "8081:8081"   # webui
      - "9999:9999"   # jmx
      - "9099:9091"   # collector-client
    command: jobmanager
    volumes:
      - /usr/local/flink/conf
    depends_on:
      - consul
      - kafka
      - elk
    environment:
      SPRING_PROFILES_ACTIVE: dstat,jvm-jmx,flink-jmx,flink-rest
      SPRING_CLOUD_CONSUL_HOST: consul
      SPRING_CLOUD_CONSUL_PORT: 8500
      CLIENT_PORT: 9091
      KAFKA_BROKER_ADDRESS: kafka:9092

  flink-taskmanager:
    image: flink
    container_name: flink-taskmanager
    ports:
      - "9998:9999"   # jmx
      - "9098:9091"   # collector-client
    command: taskmanager
    volumes_from:
      - flink-jobmanager
    depends_on:
      - flink-jobmanager
      - consul
      - kafka
      - elk
    environment:
      SPRING_PROFILES_ACTIVE: flink-rest #,jvm-jmx
      SPRING_CLOUD_CONSUL_HOST: consul
      SPRING_CLOUD_CONSUL_PORT: 8500
      CLIENT_PORT: 9091
      KAFKA_BROKER_ADDRESS: kafka:9092
      FLINK_REST_HOST: flink-jobmanager
      FLINK_REST_PORT: 8081

  elk:
    container_name: elk
    image: sebp/elk
    ports:
      - "5601:5601"
      - "9200:9200"
      - "5044:5044"
      - "5000:5000"
    depends_on:
      - zookeeper
      - kafka

  collector-manager:
    container_name: collector-manager
    image: io.thesis/collector-manager
    ports:
      - "9090:9090"
    depends_on:
      - consul
    environment:
      SERVER_PORT: 9090
      SPRING_CLOUD_CONSUL_HOST: consul
      SPRING_CLOUD_CONSUL_PORT: 8500
\end{lstlisting}

%\section{Diagrams}
%\subsection{Use Case diagram}
%
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=1.0\textwidth]{../uml/usecase-collector-process.jpg}
%	\caption{Use Case Diagramm}
%	\label{use-case-diagram}
%\end{figure}

%\begin{figure}[H]
%	\centering
%	\includegraphics[width=1.0\textwidth]{../uml/class-flink-jmx-collector.jpg}
%	\caption{Class diagram 'FlinkJmxCollector'}
%	\label{class-diagram-flink-jmx-collector}
%\end{figure}
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=1.0\textwidth]{../uml/class-kafka-broker-jmx-collector.jpg}
%	\caption{Class diagram 'KafkaBrokerJmxCollector'}
%	\label{class-diagram-kafka-broker-jmx-collector}
%\end{figure}

%\subsection{Deployment diagram}






%\begin{lstlisting}[language=json, caption={DStatCollector JSON payload}, captionpos=b, label={lst:dstat-payload}]
%{
%    "clientTimestamp": "2016-08-12T20:59:30.608",
%    "clientHost": "127.0.1.1",
%    "clientPort": 9091,
%    "instanceId": "collector-client:25ba074a0d81dd5c8e2c7b4c73152dd2",
%    "collectorType": "dstat",
%    "data": {
%        "disk": {
%            "read": 112.0,
%            "write": 436.0,
%            "utilization": 6.49,
%            "transactions": {
%                "read": 5.72,
%                "write": 8.9
%            }
%        },
%        "process": {
%            "runnable": 0.0,
%            "uninterruptible": 0.0,
%            "new": 1.4,
%            "count": 271,
%            "latency-highest-total": {
%                "name": "compiz",
%                "value": 8475.0
%            },
%            "latency-highest-avg": {
%                "name": "cat",
%                "value": 101.0
%            }
%        },
%        "memory": {
%            "usage": {
%                "used": 5548032.0,
%                "buffer": 217088.0,
%                "cache": 1626112.0,
%                "free": 695296.0
%            },
%            "process-most-expensive": {
%                "name": "java",
%                "value": 1510400.0
%            },
%            "paging": {
%                "in": 1.22265625,
%                "out": 10.8
%            },
%            "swap": {
%                "used": 312320.0,
%                "free": 7987200.0
%            },
%            "vm": {
%                "hardPageFaults": 0.5,
%                "softPageFaults": 990.0,
%                "allocated": 1476.0,
%                "free": 1500.0
%            }
%        },
%        "system": {
%            "load-avg": {
%                "1m": 1.16,
%                "5m": 1.28,
%                "15m": 1.17
%            },
%            "interrupts": 1225.0,
%            "contextSwitches": 3178.0,
%            "ipc": {
%                "messageQueue": 0.0,
%                "semaphores": 0.0,
%                "sharedMemory": 29.0
%            },
%            "unix-sockets": {
%                "datagram": 38,
%                "stream": 799,
%                "listen": 38,
%                "active": 761
%            }
%        },
%        "io": {
%            "read": 5.72,
%            "write": 8.9,
%            "process-most-expensive": {
%                "name": "upstart",
%                "pid": 3210,
%                "read": 502.0,{
%                "write": 210.0,
%                "cpuPercentage": 0.0
%            },
%            "filelocks": {
%                "posix": 33.0,
%                "flock": 4.0,
%                "read": 13.0,
%                "write": 25.0
%            },
%            "filesystem": {
%                "openFiles": 13344,
%                "inodes": 48582.0
%            }
%        },
%        "cpu": {
%            "usage": [
%                {
%                    "name": "cpu0",
%                    "user": 17.0,
%                    "system": 3.3,
%                    "idle": 77.0,
%                    "wait": 2.6,
%                    "hwInterrupt": 0.0,
%                    "swInterrupt": 0.0
%                },
%                {
%                    "name": "cpu1",
%                    "user": 17.0,
%                    "system": 3.4,
%                    "idle": 77.0,
%                    "wait": 2.7,
%                    "hwInterrupt": 0.0,
%                    "swInterrupt": 0.4
%                }
%            ],
%            "process-most-expensive": {
%                "name": "java",
%                "pid": 32528,
%                "cpuPercentage": 5.8,
%                "read": 102.0,
%                "write": 272.0
%            },
%            "process-cpu-time-highest-total": {
%                "name": "Xorg",
%                "time": 40.1
%            },
%            "process-cpu-time-highest-avg": {
%                "name": "docker-compos",
%                "time": 225.0
%            }
%        },
%        "net": {
%            "traffic": [
%                {
%                    "name": "docker0",
%                    "send": 0.0,
%                    "received": 0.0
%                },
%                {
%                    "name": "wlp2s0",
%                    "send": 0.0,
%                    "received": 0.0
%                }
%            ],
%            "sockets": {
%                "total": 1.0,
%                "tcp": 19.0,
%                "udp": 8.0,
%                "raw": 0.0,
%                "ipFragments": 0.0
%            },
%            "tcp-sockets": {
%                "listen": 20.0,
%                "established": 43.0,
%                "syn": 0.0,
%                "timeWait": 5.0,
%                "close": 0.0
%            },
%            "udp": {
%                "listen": 17.0,
%                "active": 0.0
%            }
%        }
%    }
%}
%\end{lstlisting}